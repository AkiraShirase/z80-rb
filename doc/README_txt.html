<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>File: README.txt [ruby-Z80]</title>

  <link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet" />

  <script src="./js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file">
  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./README_txt.html">README.txt</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./Z80.html">Z80</a></li>
        
          <li><a href="./Z80/Alloc.html">Z80::Alloc</a></li>
        
          <li><a href="./Z80/CompileError.html">Z80::CompileError</a></li>
        
          <li><a href="./Z80/Helpers.html">Z80::Helpers</a></li>
        
          <li><a href="./Z80/Label.html">Z80::Label</a></li>
        
          <li><a href="./Z80/Program.html">Z80::Program</a></li>
        
          <li><a href="./Z80/Program/Condition.html">Z80::Program::Condition</a></li>
        
          <li><a href="./Z80/Program/Mnemonics.html">Z80::Program::Mnemonics</a></li>
        
          <li><a href="./Z80/Program/Register.html">Z80::Program::Register</a></li>
        
          <li><a href="./Z80/Syntax.html">Z80::Syntax</a></li>
        
          <li><a href="./Z80/TAP.html">Z80::TAP</a></li>
        
          <li><a href="./Z80/TAP/TapeError.html">Z80::TAP::TapeError</a></li>
        
          <li><a href="./Z80Lib.html">Z80Lib</a></li>
        
          <li><a href="./Z80Lib/Macros.html">Z80Lib::Macros</a></li>
        
          <li><a href="./Z80MathInt.html">Z80MathInt</a></li>
        
          <li><a href="./Z80MathInt/Macros.html">Z80MathInt::Macros</a></li>
        
          <li><a href="./Symbol.html">Symbol</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    
<h1>ruby-<a href="Z80.html">Z80</a></h1>

<h2>A <a href="Z80.html">Z80</a> assembler powered by ruby.</h2>
<table class="rdoc-list"><tr><td class="rdoc-term"><p>Author</p></td>
<td>
<p>Rafa≈Ç Michalski  (<a
href="mailto:royaltm75@gmail.com">royaltm75@gmail.com</a>)</p>
</td></tr></table>

<h3>Yo, dig it:</h3>

<pre>require 'z80'

class ZXMath
  module Macros
    def mul8(eh, el, th, tl)  # performs hl * a using (a, th, tl)
                              # stops on CARRY out
                              # result to (eh|el)
      raise ArgumentError unless th|tl != hl
      ns do |eoc|
              ld  tl, l
              ld  th, h
              ld  hl,0
        loop1 srl a
              jr  NC, noadd
              add hl, th|tl
              jr  C, eoc
        noadd jr  Z, ok
              sla tl
              rl  th
              jp  NC, loop1
        ok    label
              unless  eh == h and el == l
                ld  el, l
                ld  eh, h
              end
      end
    end
  end

  include Z80

  export mul
  mul   mul8(b, c, d, e)
        ret NC
        rst 0x08             # ERROR-1
        data  1, [0x0A]      # Error Report: Integer out of range
end

class Program
  include Z80
  include Z80::TAP

                ld   hl, [multiplicand]
                ld   a,  [multiplicator]
                jp   math.mul

                org 0x0020
  multiplicand  words 1
  multiplicator bytes 1

  import :math, ZXMath

end

calc = Program.new 0x8000

calc.save_tap('calculator', :append =&gt; true)</pre>

<p>now:</p>

<pre>puts calc.debug</pre>

<p>check this out:</p>

<pre>8000: 2A2080      ld   hl, (8020H)     -&gt; multiplicand
8003: 3A2280      ld   a, (8022H)      -&gt; multiplicator
8006: C32380      jp   8023H           -&gt; math.mul
8009: 00 00 00 00 00 00 00 00 ........
8011: 00 00 00 00 00 00 00 00 ........
8019: 00 00 00 00 00 00 00    .......
8020: 00 00                   ..       :multiplicand
8022: 00                      .        :multiplicator
8023:                                  :math
======          ZXMath ===============
8023:                                  :mul
8023: 5D          ld   e, l
8024: 54          ld   d, h
8025: 210000      ld   hl, 0000H
8028: CB3F        srl  a               :mul.loop1
802A: 3003        jr   NC, 802fH       -&gt; noadd
802C: 19          add  hl, de
802D: 380B        jr   C, 803aH
802F: 2807        jr   Z, 8038H        :mul.noadd -&gt; ok
8031: CB23        sla  e
8033: CB12        rl   d
8035: D22880      jp   NC, 8028H       -&gt; loop1
8038:                                  :mul.ok
8038: 4D          ld   c, l
8039: 44          ld   b, h
803A: D0          ret  NC
803B: CF          rst  08H
803C: 0A                      .</pre>

<p>go to ZX Spectrum:</p>

<pre> 10 CLEAR 32767
 20 LOAD &quot;&quot; CODE
 30 INPUT &quot;Multiplicand: &quot;, x
 40 INPUT &quot;Multiplicator: &quot;, y
 50 POKE 32800, x-INT(x/256)*256
 60 POKE 32801, INT(x/256)
 70 POKE 32802, y
 80 PRINT &quot;x: &quot;, x, &quot;y: &quot;, y
 90 PRINT USR 32768
100 GOTO 30

RUN</pre>

<p>and load calculator.tap</p>

<p><img src="../examples/calculator.png" /></p>

<h3>More study at:</h3>
<ul><li>
<p><a href="Z80.html">Z80</a></p>
</li><li>
<p><a href="Z80/Program.html">Z80::Program</a></p>
</li><li>
<p><a href="Z80/Program/Mnemonics.html">Z80::Program::Mnemonics</a></p>
</li><li>
<p><a href="Z80/Label.html">Z80::Label</a></p>
</li><li>
<p><a href="Z80/TAP.html">Z80::TAP</a></p>
</li></ul>

<h4>See examples in <tt>examples</tt> dir.</h4>

<h3>Also features:</h3>

<p><tt>bin/zxconv</tt></p>

<p>(requires RMagick <a
href="http://rmagick.rubyforge.org/">rmagick.rubyforge.org/</a>)</p>

<pre>ZXCONV 0.2: Importing images to ZX Spectrum is fun!
Usage:
zxconv source destination [options]
  rendering options:
  -m, --mode 0|1|2|3|4        color mode
          0: 15 colors
          1: 8  basic colors
          2: 8  bright colors
          3: 15 colors, bright colors have priority
          4: 15 colors, basic colors only on black backgrounds
  -d, --dither n|r|f[n|r|f]     dithering mode phase1,phase2
          n: none
          r: riemersma
          f: floyd-steinberg
  -c, --colors CCC....        list of allowed color indexes (0..7)
  -0..15, --bg N              background color (0..15)
  -r, --ratio N/N             bright/basic color level ratio
  -l, --[no-]autolevel        apply auto level to source image
  -g, --[no-]autogamma        apply auto gamma to source image

  destination format and content:
  -f, --format t|b|r|a        zx spectrum data file format
          t: save as TAP; one file is created
          b: save as binary data; separate files for scr and bitamp
          r: save as ruby source
          a: save as assembler source
  -s, --[no-]savescr          save data as zx screen (6912 bytes)
  -b, --[no-]savebin          save b/w bitmap raw data
  -a, --[no-]saveattr         save attributes raw data
  -i, --[no-]saveimg          save as normal image
                                 (format determined by destination ext.)
  default options are:
  -m0 -dn -r4/3 -0 -ft -s -i</pre>

<p><img src="../examples/horse.jpg" /></p>

<pre>zxconv -m4 -l --no-savescr horse.jpg horse.png</pre>

<p><img src="../examples/horse.png" /></p>

<h2>Download</h2>

<p><a href="../ruby-z80_0.91+conv_0.3.zip">here</a></p>

<h2>Requirements</h2>

<h4>ruby 1.9</h4>

  </div>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>
</body>
</html>

