<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>ruby-Z80</title>

  <link type="text/css" media="screen" href="rdoc.css" rel="stylesheet" />

  <script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body class="indexpage">

  
  <h1>ruby-Z80</h1>

  
  <div id="main">
    

<h2>A <a href="Z80.html">Z80</a> assembler powered by ruby.</h2>
<table class="rdoc-list"><tr><td class="rdoc-term"><p>Author</p></td>
<td>
<p>Rafa≈Ç Michalski  (<a
href="mailto:royaltm75@gmail.com">royaltm75@gmail.com</a>)</p>
</td></tr></table>

<h3>Yo, dig it:</h3>

<pre>require 'z80'

class ZXMath
  module Macros
    def mul8(eh, el, th, tl)  # performs hl * a using (a, th, tl)
                              # stops on CARRY out
                              # result to (eh|el)
      raise ArgumentError unless th|tl != hl
      ns do |eoc|
              ld  tl, l
              ld  th, h
              ld  hl,0
        loop1 srl a
              jr  NC, noadd
              add hl, th|tl
              jr  C, eoc
        noadd jr  Z, ok
              sla tl
              rl  th
              jp  NC, loop1
        ok    label
              unless  eh == h and el == l
                ld  el, l
                ld  eh, h
              end
      end
    end
  end

  include Z80

  export mul
  mul   mul8(b, c, d, e)
        ret NC
        rst 0x08             # ERROR-1
        data  1, [0x0A]      # Error Report: Integer out of range
end

class Program
  include Z80
  include Z80::TAP

                ld   hl, [multiplicand]
                ld   a,  [multiplicator]
                jp   math.mul

                org 0x0020
  multiplicand  words 1
  multiplicator bytes 1

  import :math, ZXMath

end

calc = Program.new 0x8000

calc.save_tap('calculator', :append =&gt; true)</pre>

<p>now:</p>

<pre>puts calc.debug</pre>

<p>check this out:</p>

<pre>8000: 2A2080      ld   hl, (8020H)     -&gt; multiplicand
8003: 3A2280      ld   a, (8022H)      -&gt; multiplicator
8006: C32380      jp   8023H           -&gt; math.mul
8009: 00 00 00 00 00 00 00 00 ........
8011: 00 00 00 00 00 00 00 00 ........
8019: 00 00 00 00 00 00 00    .......
8020: 00 00                   ..       :multiplicand
8022: 00                      .        :multiplicator
8023:                                  :math
======          ZXMath ===============
8023:                                  :mul
8023: 5D          ld   e, l
8024: 54          ld   d, h
8025: 210000      ld   hl, 0000H
8028: CB3F        srl  a               :mul.loop1
802A: 3003        jr   NC, 802fH       -&gt; noadd
802C: 19          add  hl, de
802D: 380B        jr   C, 803aH
802F: 2807        jr   Z, 8038H        :mul.noadd -&gt; ok
8031: CB23        sla  e
8033: CB12        rl   d
8035: D22880      jp   NC, 8028H       -&gt; loop1
8038: 4D          ld   c, l
8039: 44          ld   b, h
803A: D0          ret  NC
803B: CF          rst  08H
803C: 0A                      .</pre>

<p>go to ZX Spectrum:</p>

<pre> 10 CLEAR 32767
 20 LOAD &quot;&quot; CODE
 30 INPUT &quot;Multiplicand: &quot;, x
 40 INPUT &quot;Multiplicator: &quot;, y
 50 POKE 32800, x-INT(x/256)*256
 60 POKE 32801, INT(x/256)
 70 POKE 32802, y
 80 PRINT &quot;x: &quot;, x, &quot;y: &quot;, y
 90 PRINT USR 32768
100 GOTO 30

RUN</pre>

<p>and load calculator.tap</p>

<p><img src="../examples/calculator.png" /></p>

<h3>More study at:</h3>
<ul><li>
<p><a href="Z80.html">Z80</a></p>
</li><li>
<p><a href="Z80/Program.html">Z80::Program</a></p>
</li><li>
<p><a href="Z80/Program/Mnemonics.html">Z80::Program::Mnemonics</a></p>
</li><li>
<p><a href="Z80/Label.html">Z80::Label</a></p>
</li><li>
<p><a href="Z80/TAP.html">Z80::TAP</a></p>
</li></ul>

<h4>See examples in <tt>examples</tt> dir.</h4>

<h3>Also features:</h3>

<p><tt>bin/zxconv</tt></p>

<p>(requires RMagick <a
href="http://rmagick.rubyforge.org/">rmagick.rubyforge.org/</a>)</p>

<pre>ZXCONV 0.2: Importing images to ZX Spectrum is fun!
Usage:
zxconv source destination [options]
  rendering options:
  -m, --mode 0|1|2|3|4        color mode
          0: 15 colors
          1: 8  basic colors
          2: 8  bright colors
          3: 15 colors, bright colors have priority
          4: 15 colors, basic colors only on black backgrounds
  -d, --dither n|r|f[n|r|f]     dithering mode phase1,phase2
          n: none
          r: riemersma
          f: floyd-steinberg
  -c, --colors CCC....        list of allowed color indexes (0..7)
  -0..15, --bg N              background color (0..15)
  -r, --ratio N/N             bright/basic color level ratio
  -l, --[no-]autolevel       apply auto level to source image
  -g, --[no-]autogamma        apply auto gamma to source image

  destination format and content:
  -f, --format t|b|r          zx spectrum data file format
          t: save as TAP; one file is created
          b: save as binary data; separate files for scr and bitamp
          r: save as ruby source
          a: save as assembler source
  -s, --[no-]savescr          save data as zx screen (6912 bytes)
  -b, --[no-]savebin          save b/w bitmap raw data
  -a, --[no-]saveattr         save attributes raw data
  -i, --[no-]saveimg          save as normal image
                                 (format determined by destination ext.)
  default options are:
  -m0 -dn -r4/3 -0 -ft -s -i</pre>

<p><img src="../examples/horse.jpg" /></p>

<pre>zxconv -m4 -l --no-savescr horse.jpg horse.png</pre>

<p><img src="../examples/horse.png" /></p>

<h2>Download</h2>

<p><a href="../ruby-z80_0.9+conv_0.2.zip">here</a></p>

<h2>Requirements</h2>

<h4>ruby 1.9</h4>

  </div>
  

  
  
  <h2>Files</h2>
  <ul>
    
      <li class="file"><a href="README_txt.html">README.txt</a></li>
    
  </ul>
  

  <h2 id="classes">Classes/Modules</h2>
  <ul>
    
    <li class="module"><a href="Z80.html">Z80</a></li>
    
    <li class="class"><a href="Z80/Alloc.html">Z80::Alloc</a></li>
    
    <li class="class"><a href="Z80/CompileError.html">Z80::CompileError</a></li>
    
    <li class="module"><a href="Z80/Helpers.html">Z80::Helpers</a></li>
    
    <li class="class"><a href="Z80/Label.html">Z80::Label</a></li>
    
    <li class="module"><a href="Z80/Program.html">Z80::Program</a></li>
    
    <li class="class"><a href="Z80/Program/Condition.html">Z80::Program::Condition</a></li>
    
    <li class="module"><a href="Z80/Program/Mnemonics.html">Z80::Program::Mnemonics</a></li>
    
    <li class="class"><a href="Z80/Program/Register.html">Z80::Program::Register</a></li>
    
    <li class="class"><a href="Z80/Syntax.html">Z80::Syntax</a></li>
    
    <li class="module"><a href="Z80/TAP.html">Z80::TAP</a></li>
    
    <li class="class"><a href="Z80/TAP/TapeError.html">Z80::TAP::TapeError</a></li>
    
    <li class="class"><a href="Symbol.html">Symbol</a></li>
    
  </ul>

  <h2 id="methods">Methods</h2>
  <ul>
    
      <li><a href="Z80/Program/Register.html#method-c-5B-5D">::[] &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Program/Condition.html#method-c-5B-5D">::[] &mdash; Z80::Program::Condition</a></li>
    
      <li><a href="Z80.html#method-c-add_code">::add_code &mdash; Z80</a></li>
    
      <li><a href="Z80.html#method-c-add_reloc">::add_reloc &mdash; Z80</a></li>
    
      <li><a href="Z80/Label.html#method-c-byte">::byte &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Label.html#method-c-dummy">::dummy &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Label.html#method-c-members_of_struct">::members_of_struct &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program/Register.html#method-c-names">::names &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Program/Condition.html#method-c-names">::names &mdash; Z80::Program::Condition</a></li>
    
      <li><a href="Z80/Program/Register.html#method-c-new">::new &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Alloc.html#method-c-new">::new &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-c-new">::new &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program/Condition.html#method-c-new">::new &mdash; Z80::Program::Condition</a></li>
    
      <li><a href="Z80/TAP.html#method-c-read_data">::read_data &mdash; Z80::TAP</a></li>
    
      <li><a href="Z80/Label.html#method-c-to_data">::to_data &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Label.html#method-c-word">::word &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-2A">#* &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-2A">#* &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Label.html#method-i-2B">#+ &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-2B">#+ &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-2B">#+ &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-2B-40">#+@ &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-2B-40">#+@ &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-2D">#- &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-2D">#- &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-2D">#- &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Label.html#method-i-3E-3E">#>> &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-3E-3E">#>> &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-5B-5D">#[] &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-5B-5D">#[] &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-5B-5D">#[] &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Program.html#method-i-5B-5D">#[] &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-addr">#addr &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-bit8-3F">#bit8? &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Program.html#method-i-bytes">#bytes &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Helpers.html#method-i-cpl">#cpl &mdash; Z80::Helpers</a></li>
    
      <li><a href="Z80/Program.html#method-i-data">#data &mdash; Z80::Program</a></li>
    
      <li><a href="Z80.html#method-i-debug">#debug &mdash; Z80</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-deep_clone_with_relocation">#deep_clone_with_relocation &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-deep_clone_with_relocation">#deep_clone_with_relocation &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-dummy-3F">#dummy? &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-dummy-3F">#dummy? &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-dup">#dup &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Program.html#method-i-export">#export &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Helpers.html#method-i-h">#h &mdash; Z80::Helpers</a></li>
    
      <li><a href="Z80/Helpers.html#method-i-hb">#hb &mdash; Z80::Helpers</a></li>
    
      <li><a href="Z80/Label.html#method-i-immediate-3F">#immediate? &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-immediate-3F">#immediate? &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Program.html#method-i-import">#import &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-import_file">#import_file &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Label.html#method-i-initialize">#initialize &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program.html#method-i-label">#label &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-macro">#macro &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-method_missing">#method_missing &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Label.html#method-i-method_missing">#method_missing &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-method_missing">#method_missing &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-name-3D">#name= &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-name-3D">#name= &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Helpers.html#method-i-neg">#neg &mdash; Z80::Helpers</a></li>
    
      <li><a href="Z80/Program.html#method-i-new">#new &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-ns">#ns &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-one_of-3F">#one_of? &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Program.html#method-i-org">#org &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-pc">#pc &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Label.html#method-i-pointer-3F">#pointer? &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-pointer-3F">#pointer? &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-pointer-3F">#pointer? &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-reinitialize">#reinitialize &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-reinitialize">#reinitialize &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-relocations">#relocations &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/TAP.html#method-i-save_tap">#save_tap &mdash; Z80::TAP</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-size">#size &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-to_alloc">#to_alloc &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-to_alloc">#to_alloc &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-to_debug">#to_debug &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Program/Condition.html#method-i-to_i">#to_i &mdash; Z80::Program::Condition</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-to_i">#to_i &mdash; Z80::Program::Register</a></li>
    
      <li><a href="Z80/Label.html#method-i-to_i">#to_i &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-to_i">#to_i &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-to_label">#to_label &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-to_label">#to_label &mdash; Z80::Label</a></li>
    
      <li><a href="Symbol.html#method-i-to_label">#to_label &mdash; Symbol</a></li>
    
      <li><a href="Z80/Label.html#method-i-to_name">#to_name &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-to_name">#to_name &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-to_s">#to_s &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/Label.html#method-i-to_s">#to_s &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Label.html#method-i-to_str">#to_str &mdash; Z80::Label</a></li>
    
      <li><a href="Z80/Alloc.html#method-i-to_str">#to_str &mdash; Z80::Alloc</a></li>
    
      <li><a href="Z80/TAP.html#method-i-to_tap">#to_tap &mdash; Z80::TAP</a></li>
    
      <li><a href="Z80/Program.html#method-i-union">#union &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program.html#method-i-words">#words &mdash; Z80::Program</a></li>
    
      <li><a href="Z80/Program/Register.html#method-i-7C">#| &mdash; Z80::Program::Register</a></li>
    
  </ul>

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>
</body>
</html>
